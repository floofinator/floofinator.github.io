<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas</title>
</head>
<body>

<style>
    * { margin: 0; padding: 0; box-sizing: border-box;}
    body, html{
        width: 100%;
        height: 100%;
    }
    canvas{
        display: block;
        position: fixed;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0);
        pointer-events: none;
    }
</style>
<canvas id="area"></canvas>
<script src='http://git.io/perlin.js'></script>
<script>
class Point{
    constructor(x,y,driftx,drifty){
        this.x = x;
        this.y = y;
        this.driftx = driftx;
        this.drifty = drifty;
    }
    drift() {
        this.x += this.driftx;
        this.y += this.drifty;
    }
    accelerate(){
        this.driftx *= 1.01;
        this.drifty *= 1.01;
    }
}
var canvas = document.getElementById("area");
var context = canvas.getContext("2d");
var mousePosition = new Point(0,0);
var wind = new Point(0,0,0.01,0.01);
var interval = setInterval(updateDrawArea,20);
const length = 64;
const scale = 2;
const driftSpeed = 2;
var pointList = [];
updateCanvasSize();
window.onresize = updateCanvasSize;
window.onmousemove = function(e){mousePosition = new Point(e.clientX,e.clientY);};
function addPoint(){
    const perlinX = (mousePosition.x/canvas.clientWidth)*scale + wind.x;
    const perlinY = (mousePosition.y/canvas.clientHeight)*scale + wind.y;
    const driftx = perlin.get(perlinX,perlinY);
    const drifty = perlin.get(perlinX+0.25,perlinY+0.25);
    console.log(driftx);
    console.log(drifty);
    newPoint = new Point(mousePosition.x,mousePosition.y,driftx,drifty);
    pointList.push(newPoint);
    if(pointList.length > length)
        pointList.shift();
}
function driftLine(pointList){
    for (let index = 0; index < pointList.length; index++) {
        const point = pointList[index];
        point.drift();
        point.accelerate();
    }
}
function drawLine(pointList){
    context.lineJoin = "round";
    context.lineCap = "round";
    context.lineWidth = 4;
    context.beginPath();
    context.strokeStyle = "hsla(180,50%,75%,0.75)"
    for (let index = 1; index < pointList.length; index++) {
        const point = pointList[index];
        const previous = pointList[index-1];
        context.moveTo(previous.x,previous.y);
        context.lineTo(point.x,point.y);
    }
    context.stroke();
}
function updateCanvasSize(){
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
}
function clearDrawArea(){context.clearRect(0, 0, canvas.width, canvas.height);}
function updateDrawArea(){
    clearDrawArea();
    wind.drift();
    addPoint(mousePosition);
    driftLine(pointList);
    drawLine(pointList);
}
</script>

</body>
</html>